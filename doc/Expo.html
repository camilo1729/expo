<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: Expo
  
    &mdash; Documentation by YARD 0.8.2.1
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (E)</a> &raquo;
    
    
    <span class="title">Expo</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
    <a class="full_list_link" id="tag_list_link"
        href="tag_list.html">
      Tag List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Module: Expo
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
    <dt class="r1">Included in:</dt>
    <dd class="r1"><span class='object_link'><a href="ExpoEngine.html" title="ExpoEngine (class)">ExpoEngine</a></span></dd>
    
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/expolib.rb<span class="defines">,<br />
  lib/g5k_api.rb,<br /> lib/taskset.rb,<br /> lib/g5k_api_old.rb,<br /> lib/resourceset.rb,<br /> lib/expo_planetlab.rb</span>
</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Creating ‘resources’ from the assigned nodes to put them after into</p>

<p>$all ResourceSet</p>


  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Expo/ExpoResult.html" title="Expo::ExpoResult (class)">ExpoResult</a></span>, <span class='object_link'><a href="Expo/GenericTask.html" title="Expo::GenericTask (class)">GenericTask</a></span>, <span class='object_link'><a href="Expo/NameSet.html" title="Expo::NameSet (class)">NameSet</a></span>, <span class='object_link'><a href="Expo/ParallelSection.html" title="Expo::ParallelSection (class)">ParallelSection</a></span>, <span class='object_link'><a href="Expo/Resource.html" title="Expo::Resource (class)">Resource</a></span>, <span class='object_link'><a href="Expo/ResourceSet.html" title="Expo::ResourceSet (class)">ResourceSet</a></span>, <span class='object_link'><a href="Expo/ResourceSetIterator.html" title="Expo::ResourceSetIterator (class)">ResourceSetIterator</a></span>, <span class='object_link'><a href="Expo/Task.html" title="Expo::Task (class)">Task</a></span>, <span class='object_link'><a href="Expo/TaskResult.html" title="Expo::TaskResult (class)">TaskResult</a></span>, <span class='object_link'><a href="Expo/TaskSet.html" title="Expo::TaskSet (class)">TaskSet</a></span>, <span class='object_link'><a href="Expo/TaskStream.html" title="Expo::TaskStream (class)">TaskStream</a></span>
    
  
</p>







  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_machines-class_method" title="get_machines (class method)">+ (Object) <strong>get_machines</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#atask-instance_method" title="#atask (instance method)">- (Object) <strong>atask</strong>(location, task) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#check-instance_method" title="#check (instance method)">- (Object) <strong>check</strong>(nodes) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#convert_to_resource-instance_method" title="#convert_to_resource (instance method)">- (Object) <strong>convert_to_resource</strong>(job, site) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#extract_resources_new-instance_method" title="#extract_resources_new (instance method)">- (Object) <strong>extract_resources_new</strong>(result) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#g5k_init-instance_method" title="#g5k_init (instance method)">- (Object) <strong>g5k_init</strong>(experim_params) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>sets up the reservation parameters.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#g5k_reserve-instance_method" title="#g5k_reserve (instance method)">- (Object) <strong>g5k_reserve</strong>(options) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>reserve the remote nodes with parameters specified in $options.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#g5k_run-instance_method" title="#g5k_run (instance method)">- (Object) <strong>g5k_run</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>run reservation and deployment.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get-instance_method" title="#get (instance method)">- (Object) <strong>get</strong>(file, source, params = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_results-instance_method" title="#get_results (instance method)">- (Object) <strong>get_results</strong>(targets, file, where = &quot;~/&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#log_file_mgt-instance_method" title="#log_file_mgt (instance method)">- (Object) <strong>log_file_mgt</strong>(file, result_with_id, type) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>logging File managment ################.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#log_task-instance_method" title="#log_task (instance method)">- (Object) <strong>log_task</strong>(command, result_with_id, type) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>loggin’ tasks #############</p>
<dl class="rdoc-list label-list"><dt> &lt;LogActor&gt; 
<dd><dl class="rdoc-list label-list"><dt> &lt;LogSubject&gt; 
<dd>
<p>&lt;LogMessage&gt;</p>
</dd></dl>
</dd><dt> Task:ID 
<dd><dl class="rdoc-list label-list"><dt> Action 
<dd>
<p>Message.</p>
</dd></dl>
</dd></dl>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#make_taktuk_result-instance_method" title="#make_taktuk_result (instance method)">- (Object) <strong>make_taktuk_result</strong>(id) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#make_task_result-instance_method" title="#make_task_result (instance method)">- (Object) <strong>make_task_result</strong>(id) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parallel_section-instance_method" title="#parallel_section (instance method)">- (Object) <strong>parallel_section</strong>(&amp;block) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#print_taktuk_result-instance_method" title="#print_taktuk_result (instance method)">- (Object) <strong>print_taktuk_result</strong>(res) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ptask-instance_method" title="#ptask (instance method)">- (Object) <strong>ptask</strong>(targets, task) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#put-instance_method" title="#put (instance method)">- (Object) <strong>put</strong>(file, destination, params = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#simpletask-instance_method" title="#simpletask (instance method)">- (Object) <strong>simpletask</strong>(location, task) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Fix me #######.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#task-instance_method" title="#task (instance method)">- (Object) <strong>task</strong>(location, task) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Starting Definitions of functions that belongs to the DSL of expo.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#treat_task-instance_method" title="#treat_task (instance method)">- (Object) <strong>treat_task</strong>(task) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Treat the task which is a Sring in order to sperate it into path, exec,
cmdline params.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="get_machines-class_method">
  
    + (<tt>Object</tt>) <strong>get_machines</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/expo_planetlab.rb', line 18</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_get_machines identifier id'>get_machines</span>

   <span class='rubyid_puts identifier id'>puts</span> <span class='string val'>&quot;already Charged&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_$loaded gvar id'>$loaded</span>
   <span class='rubyid_return return kw'>return</span> <span class='rubyid_nil nil kw'>nil</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_$loaded gvar id'>$loaded</span>
   <span class='rubyid_$loaded gvar id'>$loaded</span><span class='assign token'>=</span><span class='rubyid_true true kw'>true</span> <span class='rubyid_if if_mod kw'>if</span> <span class='notop op'>!</span><span class='rubyid_$loaded gvar id'>$loaded</span>
   <span class='comment val'>#puts &quot;Putting some planet lab nodes in the resources variable&quot;</span>
   <span class='rubyid_server identifier id'>server</span> <span class='assign token'>=</span> <span class='rubyid_XMLRPC constant id'>XMLRPC</span><span class='colon2 op'>::</span><span class='rubyid_Client constant id'>Client</span><span class='dot token'>.</span><span class='rubyid_new2 identifier id'>new2</span><span class='lparen token'>(</span><span class='string val'>&quot;https://www.planet-lab.eu/PLCAPI/&quot;</span><span class='rparen token'>)</span>
   <span class='comment val'>#gettring the parameters from configuration file</span>
   <span class='rubyid_file_path identifier id'>file_path</span><span class='assign token'>=</span><span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_expand_path identifier id'>expand_path</span><span class='lparen token'>(</span><span class='string val'>'~/.planetlab-API.cfg'</span><span class='rparen token'>)</span>
   <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;File path : #{file_path}&quot;</span>

   <span class='rubyid_config_pl identifier id'>config_pl</span><span class='assign token'>=</span><span class='rubyid_ParseConfig constant id'>ParseConfig</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_file_path identifier id'>file_path</span><span class='rparen token'>)</span>
   <span class='rubyid_auth identifier id'>auth</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span>
   <span class='rubyid_auth identifier id'>auth</span><span class='lbrack token'>[</span><span class='string val'>'Username'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_config_pl identifier id'>config_pl</span><span class='dot token'>.</span><span class='rubyid_get_value identifier id'>get_value</span><span class='lparen token'>(</span><span class='string val'>'username'</span><span class='rparen token'>)</span>
   <span class='rubyid_auth identifier id'>auth</span><span class='lbrack token'>[</span><span class='string val'>'AuthMethod'</span><span class='rbrack token'>]</span><span class='assign token'>=</span> <span class='string val'>&quot;password&quot;</span>
   <span class='rubyid_auth identifier id'>auth</span><span class='lbrack token'>[</span><span class='string val'>'AuthString'</span><span class='rbrack token'>]</span><span class='assign token'>=</span> <span class='rubyid_config_pl identifier id'>config_pl</span><span class='dot token'>.</span><span class='rubyid_get_value identifier id'>get_value</span><span class='lparen token'>(</span><span class='string val'>'password'</span><span class='rparen token'>)</span>

   <span class='rubyid_query identifier id'>query</span><span class='assign token'>=</span><span class='rubyid_server identifier id'>server</span><span class='dot token'>.</span><span class='rubyid_call identifier id'>call</span><span class='lparen token'>(</span><span class='string val'>&quot;GetSlices&quot;</span><span class='comma token'>,</span><span class='rubyid_auth identifier id'>auth</span><span class='comma token'>,</span><span class='lbrace token'>{</span><span class='string val'>'name'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;lig_expe&quot;</span><span class='rbrace token'>}</span><span class='comma token'>,</span><span class='lbrack token'>[</span><span class='string val'>'node_ids'</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
   <span class='rubyid_node_ids identifier id'>node_ids</span><span class='assign token'>=</span><span class='rubyid_query identifier id'>query</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>'node_ids'</span><span class='rbrack token'>]</span>
   <span class='rubyid_nodes_hostnames identifier id'>nodes_hostnames</span><span class='assign token'>=</span><span class='rubyid_server identifier id'>server</span><span class='dot token'>.</span><span class='rubyid_call identifier id'>call</span><span class='lparen token'>(</span><span class='string val'>&quot;GetNodes&quot;</span><span class='comma token'>,</span><span class='rubyid_auth identifier id'>auth</span><span class='comma token'>,</span><span class='lbrace token'>{</span><span class='string val'>'node_id'</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='rubyid_node_ids identifier id'>node_ids</span><span class='rbrace token'>}</span><span class='comma token'>,</span><span class='lbrack token'>[</span><span class='string val'>'hostname'</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>

   <span class='rubyid_nodes identifier id'>nodes</span> <span class='assign token'>=</span> <span class='rubyid_nodes_hostnames identifier id'>nodes_hostnames</span><span class='dot token'>.</span><span class='rubyid_map identifier id'>map</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_item identifier id'>item</span><span class='bitor op'>|</span> <span class='rubyid_item identifier id'>item</span><span class='dot token'>.</span><span class='rubyid_values identifier id'>values</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_flatten identifier id'>flatten</span>
 

   <span class='rubyid_nodes identifier id'>nodes</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_node identifier id'>node</span><span class='bitor op'>|</span>
  <span class='rubyid_resource identifier id'>resource</span> <span class='assign token'>=</span> <span class='rubyid_Resource constant id'>Resource</span><span class='colon2 op'>::</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:node</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_node identifier id'>node</span><span class='rparen token'>)</span>
  <span class='comment val'>#puts &quot;Adding #{node}&quot;</span>
  <span class='rubyid_$all gvar id'>$all</span><span class='dot token'>.</span><span class='rubyid_push identifier id'>push</span><span class='lparen token'>(</span><span class='rubyid_resource identifier id'>resource</span><span class='rparen token'>)</span>
   <span class='rbrace token'>}</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="atask-instance_method">
  
    - (<tt>Object</tt>) <strong>atask</strong>(location, task) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/expolib.rb', line 246</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_atask identifier id'>atask</span><span class='lparen token'>(</span><span class='rubyid_location identifier id'>location</span><span class='comma token'>,</span> <span class='rubyid_task identifier id'>task</span><span class='rparen token'>)</span>
  <span class='comment val'>#cmd = &quot;taktuk2yaml -s&quot;</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='assign token'>=</span> <span class='string val'>&quot;ruby taktuk2yaml.rb -s&quot;</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='rubyid_$ssh_connector gvar id'>$ssh_connector</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; -l #{$ssh_user}&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='notop op'>!</span><span class='rubyid_$ssh_user gvar id'>$ssh_user</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; -t #{$ssh_timeout}&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='notop op'>!</span><span class='rubyid_$ssh_timeout gvar id'>$ssh_timeout</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; -m #{location}&quot;</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; b e [ #{task} ]&quot;</span>
  <span class='comment val'>#----to create an asynch cmd we use generic cmd BUT! we don't wait</span>
  <span class='comment val'>#    till it finishes and continue execution of main process. In case</span>
  <span class='comment val'>#    of asynch cmd, response will contain only cmd id number</span>
  <span class='rubyid_command_result identifier id'>command_result</span> <span class='assign token'>=</span> <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_asynchronous_command identifier id'>asynchronous_command</span><span class='lparen token'>(</span><span class='rubyid_cmd identifier id'>cmd</span><span class='rparen token'>)</span>
  <span class='comment val'>#----means only one atask can be inside this block at a time</span>
  <span class='rubyid_$atasks_mutex gvar id'>$atasks_mutex</span><span class='dot token'>.</span><span class='rubyid_synchronize identifier id'>synchronize</span> <span class='lbrace token'>{</span>
    <span class='comment val'>#----register our asynch cmd with provided params</span>
    <span class='rubyid_$atasks gvar id'>$atasks</span><span class='lbrack token'>[</span><span class='rubyid_command_result identifier id'>command_result</span><span class='lbrack token'>[</span><span class='string val'>&quot;command_number&quot;</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='string val'>&quot;location&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_location identifier id'>location</span> <span class='comma token'>,</span> <span class='string val'>&quot;task&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_task identifier id'>task</span> <span class='rbrace token'>}</span>
  <span class='rbrace token'>}</span>

<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="check-instance_method">
  
    - (<tt>Object</tt>) <strong>check</strong>(nodes) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/expo_planetlab.rb', line 49</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_check identifier id'>check</span><span class='lparen token'>(</span> <span class='rubyid_nodes identifier id'>nodes</span> <span class='rparen token'>)</span>
 <span class='rubyid_n identifier id'>n</span> <span class='assign token'>=</span> <span class='rubyid_nodes identifier id'>nodes</span><span class='dot token'>.</span><span class='rubyid_flatten identifier id'>flatten</span><span class='lparen token'>(</span><span class='symbol val'>:node</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_uniq identifier id'>uniq</span>
 <span class='rubyid_puts identifier id'>puts</span> <span class='string val'>&quot;Testing: &quot;</span> <span class='plus op'>+</span> <span class='rubyid_n identifier id'>n</span><span class='dot token'>.</span><span class='rubyid_inspect identifier id'>inspect</span>

 <span class='rubyid_test_nis identifier id'>test_nis</span> <span class='assign token'>=</span> <span class='string val'>&quot;ruby taktuk2yaml.rb -s&quot;</span>
 
 <span class='rubyid_test_nis identifier id'>test_nis</span> <span class='opasgn op'>+=</span> <span class='rubyid_$ssh_connector gvar id'>$ssh_connector</span>
 <span class='rubyid_test_nis identifier id'>test_nis</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; -l #{$ssh_user}&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_$ssh_user gvar id'>$ssh_user</span> <span class='neq op'>!=</span> <span class='string val'>&quot;&quot;</span>
   <span class='rubyid_test_nis identifier id'>test_nis</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; -t #{$ssh_timeout}&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_$ssh_timeout gvar id'>$ssh_timeout</span> <span class='neq op'>!=</span> <span class='string val'>&quot;&quot;</span>

   <span class='comment val'>#n.each(:node) { |x|</span>
     <span class='comment val'>#  test_nis += &quot; -m #{x}&quot;</span>
   <span class='comment val'>#}</span>
   <span class='comment val'>#test_nis += &quot; broadcast exec [ date ]&quot;</span>
 <span class='rubyid_test_nis identifier id'>test_nis</span> <span class='opasgn op'>+=</span> <span class='rubyid_nodes identifier id'>nodes</span><span class='dot token'>.</span><span class='rubyid_make_taktuk_command identifier id'>make_taktuk_command</span><span class='lparen token'>(</span><span class='string val'>&quot;date&quot;</span><span class='rparen token'>)</span>
 <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Command generated #{test_nis}&quot;</span>
   <span class='rubyid_command_result identifier id'>command_result</span> <span class='assign token'>=</span> <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_asynchronous_command identifier id'>asynchronous_command</span><span class='lparen token'>(</span><span class='rubyid_test_nis identifier id'>test_nis</span><span class='rparen token'>)</span>
   <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_command_wait identifier id'>command_wait</span><span class='lparen token'>(</span><span class='rubyid_command_result identifier id'>command_result</span><span class='lbrack token'>[</span><span class='string val'>&quot;command_number&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='integer val'>1</span><span class='rparen token'>)</span>
 <span class='rubyid_result identifier id'>result</span> <span class='assign token'>=</span> <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_command_result identifier id'>command_result</span><span class='lparen token'>(</span><span class='rubyid_command_result identifier id'>command_result</span><span class='lbrack token'>[</span><span class='string val'>&quot;command_number&quot;</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
 <span class='rubyid_tree identifier id'>tree</span> <span class='assign token'>=</span> <span class='rubyid_YAML constant id'>YAML</span><span class='colon2 op'>::</span><span class='rubyid_load identifier id'>load</span><span class='lparen token'>(</span> <span class='rubyid_result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>&quot;stdout&quot;</span><span class='rbrack token'>]</span> <span class='rparen token'>)</span>
 <span class='comment val'>#                </span>
       <span class='rubyid_puts identifier id'>puts</span> <span class='string val'>&quot;Failing nodes :&quot;</span>
       <span class='rubyid_tree identifier id'>tree</span><span class='lbrack token'>[</span><span class='string val'>&quot;connectors&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_each_value identifier id'>each_value</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_error identifier id'>error</span><span class='bitor op'>|</span>

 <span class='rubyid_if if kw'>if</span> <span class='rubyid_error identifier id'>error</span><span class='lbrack token'>[</span><span class='string val'>&quot;output&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_scan identifier id'>scan</span><span class='lparen token'>(</span><span class='string val'>&quot;Connection timed out&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_pop identifier id'>pop</span> <span class='rubyid_or or kw'>or</span> <span class='rubyid_error identifier id'>error</span><span class='lbrack token'>[</span><span class='string val'>&quot;output&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_scan identifier id'>scan</span><span class='lparen token'>(</span><span class='string val'>&quot;DOING SOMETHING NASTY&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_pop identifier id'>pop</span> <span class='rubyid_or or kw'>or</span> <span class='rubyid_error identifier id'>error</span><span class='lbrack token'>[</span><span class='string val'>&quot;output&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_scan identifier id'>scan</span><span class='lparen token'>(</span><span class='string val'>&quot;timeouted&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_pop identifier id'>pop</span> <span class='rubyid_or or kw'>or</span> <span class='rubyid_error identifier id'>error</span><span class='lbrack token'>[</span><span class='string val'>&quot;output&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_scan identifier id'>scan</span><span class='lparen token'>(</span><span class='string val'>&quot;Connection closed by remote host&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_pop identifier id'>pop</span> <span class='rubyid_or or kw'>or</span> <span class='rubyid_error identifier id'>error</span><span class='lbrack token'>[</span><span class='string val'>&quot;output&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_scan identifier id'>scan</span><span class='lparen token'>(</span><span class='string val'>&quot;Permission denied&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_pop identifier id'>pop</span> <span class='rubyid_or or kw'>or</span> <span class='rubyid_error identifier id'>error</span><span class='lbrack token'>[</span><span class='string val'>&quot;output&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_scan identifier id'>scan</span><span class='lparen token'>(</span><span class='string val'>&quot;Name or service not known&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_pop identifier id'>pop</span> <span class='rubyid_or or kw'>or</span> <span class='rubyid_error identifier id'>error</span><span class='lbrack token'>[</span><span class='string val'>&quot;output&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_scan identifier id'>scan</span><span class='lparen token'>(</span><span class='string val'>&quot;vserver ... suexec&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_pop identifier id'>pop</span> <span class='rubyid_then then kw'>then</span> 
   <span class='rubyid_nodes identifier id'>nodes</span><span class='dot token'>.</span><span class='rubyid_delete_if identifier id'>delete_if</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_resource identifier id'>resource</span><span class='bitor op'>|</span> <span class='rubyid_resource identifier id'>resource</span><span class='dot token'>.</span><span class='rubyid_name identifier id'>name</span> <span class='eq op'>==</span> <span class='rubyid_error identifier id'>error</span><span class='lbrack token'>[</span><span class='string val'>&quot;peer&quot;</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span>
               <span class='rubyid_puts identifier id'>puts</span> <span class='rubyid_error identifier id'>error</span><span class='lbrack token'>[</span><span class='string val'>&quot;peer&quot;</span><span class='rbrack token'>]</span><span class='plus op'>+</span><span class='string val'>&quot; : &quot;</span><span class='plus op'>+</span><span class='rubyid_error identifier id'>error</span><span class='lbrack token'>[</span><span class='string val'>&quot;output&quot;</span><span class='rbrack token'>]</span>
        <span class='rubyid_end end kw'>end</span>
       <span class='rbrace token'>}</span>
      <span class='rubyid_return return kw'>return</span> <span class='rubyid_nil nil kw'>nil</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="convert_to_resource-instance_method">
  
    - (<tt>Object</tt>) <strong>convert_to_resource</strong>(job, site) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/g5k_api.rb', line 174</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_convert_to_resource identifier id'>convert_to_resource</span><span class='lparen token'>(</span><span class='rubyid_job identifier id'>job</span><span class='comma token'>,</span> <span class='rubyid_site identifier id'>site</span><span class='rparen token'>)</span>

  <span class='rubyid_job_name identifier id'>job_name</span> <span class='assign token'>=</span> <span class='rubyid_job identifier id'>job</span><span class='lbrack token'>[</span><span class='string val'>'name'</span><span class='rbrack token'>]</span>
  <span class='rubyid_job_nodes identifier id'>job_nodes</span> <span class='assign token'>=</span> <span class='rubyid_job identifier id'>job</span><span class='lbrack token'>[</span><span class='string val'>'assigned_nodes'</span><span class='rbrack token'>]</span>
  <span class='comment val'># job_id will be the same for all the clusters of one site                                                                            </span>
  
  <span class='rubyid_job_id identifier id'>job_id</span> <span class='assign token'>=</span> <span class='rubyid_job identifier id'>job</span><span class='lbrack token'>[</span><span class='string val'>'uid'</span><span class='rbrack token'>]</span>

  <span class='rubyid_clusters identifier id'>clusters</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>

  <span class='rubyid_regexp identifier id'>regexp</span> <span class='assign token'>=</span> <span class='regexp val'>/(\w*)-\w*/</span>
  <span class='rubyid_job_nodes identifier id'>job_nodes</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_node identifier id'>node</span><span class='bitor op'>|</span>
    <span class='rubyid_cl identifier id'>cl</span> <span class='assign token'>=</span> <span class='rubyid_regexp identifier id'>regexp</span><span class='dot token'>.</span><span class='rubyid_match identifier id'>match</span><span class='lparen token'>(</span><span class='rubyid_node identifier id'>node</span><span class='rparen token'>)</span>
    <span class='rubyid_clusters identifier id'>clusters</span><span class='dot token'>.</span><span class='rubyid_push identifier id'>push</span><span class='lparen token'>(</span><span class='rubyid_cl identifier id'>cl</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='rbrace token'>}</span>

  <span class='rubyid_clusters identifier id'>clusters</span><span class='dot token'>.</span><span class='rubyid_uniq! fid id'>uniq!</span>

  <span class='comment val'># will contain hash like         </span>
  <span class='comment val'># {                                                                                                                                     </span>
  <span class='comment val'>#   &quot;paradent&quot; =&gt; {                                                                                                                     </span>
  <span class='comment val'>#     345212 =&gt; {                                                                                                                       </span>
  <span class='comment val'>#       &quot;name&quot; =&gt; &quot;job_name&quot;,                                                                                                           </span>
  <span class='comment val'>#       &quot;nodes&quot; =&gt; [ &quot;paradent-1&quot;, &quot;paradent-12&quot;                                                                                        </span>
  <span class='comment val'>#     }                                                                                                                                 </span>
  <span class='comment val'>#   }                                                                                                                                   </span>
  <span class='comment val'>#   &quot;parapluie&quot; =&gt; {                                                                                                                    </span>
  <span class='comment val'>#     345212 =&gt; ...                                                                                                                     </span>
  <span class='rubyid_clusters_hash identifier id'>clusters_hash</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='rubyid_clusters identifier id'>clusters</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_cluster identifier id'>cluster</span><span class='bitor op'>|</span>
    <span class='comment val'>#first sub-hash                                                                                                                       </span>
    <span class='rubyid_uid_hash identifier id'>uid_hash</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='comment val'>#second sub-hash                                                                                                                      </span>
    <span class='rubyid_nodes_hash identifier id'>nodes_hash</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='rubyid_nodes_hash identifier id'>nodes_hash</span><span class='lbrack token'>[</span><span class='string val'>&quot;name&quot;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_job_name identifier id'>job_name</span>
    <span class='rubyid_job_nodes identifier id'>job_nodes</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_node identifier id'>node</span><span class='bitor op'>|</span>
      <span class='comment val'>#find out the cluster to which this node belongs                                                                                    </span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_node identifier id'>node</span> <span class='match op'>=~</span> <span class='dregexp node'>/#{cluster}\w*/</span>
        <span class='comment val'>#if there are already nodes in this cluster - add in array                                                                        </span>
        <span class='rubyid_if if kw'>if</span> <span class='rubyid_nodes_hash identifier id'>nodes_hash</span><span class='dot token'>.</span><span class='rubyid_has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='string val'>&quot;nodes&quot;</span><span class='rparen token'>)</span>
          <span class='rubyid_nodes_hash identifier id'>nodes_hash</span><span class='lbrack token'>[</span><span class='string val'>&quot;nodes&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_push identifier id'>push</span><span class='lparen token'>(</span><span class='rubyid_node identifier id'>node</span><span class='rparen token'>)</span>
        <span class='comment val'>#if this node is the first in this cluster - create an array                                                                      </span>
        <span class='comment val'>#of nodes with this node and add the array to hash                                                                                </span>
        <span class='rubyid_else else kw'>else</span>
          <span class='rubyid_nodes_array identifier id'>nodes_array</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
          <span class='rubyid_nodes_array identifier id'>nodes_array</span><span class='dot token'>.</span><span class='rubyid_push identifier id'>push</span><span class='lparen token'>(</span><span class='rubyid_node identifier id'>node</span><span class='rparen token'>)</span>
          <span class='rubyid_nodes_hash identifier id'>nodes_hash</span><span class='lbrack token'>[</span><span class='string val'>&quot;nodes&quot;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_nodes_array identifier id'>nodes_array</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rbrace token'>}</span>
    <span class='rubyid_uid_hash identifier id'>uid_hash</span><span class='lbrack token'>[</span><span class='rubyid_job_id identifier id'>job_id</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_nodes_hash identifier id'>nodes_hash</span>
    <span class='rubyid_if if kw'>if</span> <span class='notop op'>!</span><span class='lparen token'>(</span><span class='rubyid_clusters_hash identifier id'>clusters_hash</span><span class='dot token'>.</span><span class='rubyid_has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='rubyid_cluster identifier id'>cluster</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
      <span class='rubyid_clusters_hash identifier id'>clusters_hash</span><span class='lbrack token'>[</span><span class='rubyid_cluster identifier id'>cluster</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_uid_hash identifier id'>uid_hash</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rbrace token'>}</span>
  <span class='rubyid_clusters_hash identifier id'>clusters_hash</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="extract_resources_new-instance_method">
  
    - (<tt>Object</tt>) <strong>extract_resources_new</strong>(result) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/g5k_api.rb', line 234</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_extract_resources_new identifier id'>extract_resources_new</span><span class='lparen token'>(</span><span class='rubyid_result identifier id'>result</span><span class='rparen token'>)</span>
  <span class='rubyid_result identifier id'>result</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span><span class='rubyid_value identifier id'>value</span><span class='bitor op'>|</span>
    <span class='comment val'># { &quot;cluster&quot; =&gt; {...} }                                                                                                              </span>
      <span class='rubyid_cluster identifier id'>cluster</span> <span class='assign token'>=</span> <span class='rubyid_key identifier id'>key</span>
    <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span><span class='rubyid_value identifier id'>value</span><span class='bitor op'>|</span>
      <span class='comment val'># { &quot;job_id&quot; =&gt; {...} }                                                                                                             </span>
        <span class='rubyid_jobid identifier id'>jobid</span> <span class='assign token'>=</span> <span class='rubyid_key identifier id'>key</span>
        <span class='rubyid_resource_set identifier id'>resource_set</span> <span class='assign token'>=</span> <span class='rubyid_ResourceSet constant id'>ResourceSet</span><span class='colon2 op'>::</span><span class='rubyid_new identifier id'>new</span>
        <span class='rubyid_resource_set identifier id'>resource_set</span><span class='dot token'>.</span><span class='rubyid_properties identifier id'>properties</span><span class='lbrack token'>[</span><span class='symbol val'>:id</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_jobid identifier id'>jobid</span>
        <span class='rubyid_resource_set identifier id'>resource_set</span><span class='dot token'>.</span><span class='rubyid_properties identifier id'>properties</span><span class='lbrack token'>[</span><span class='symbol val'>:alias</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_cluster identifier id'>cluster</span>
  
      <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span><span class='rubyid_value identifier id'>value</span><span class='bitor op'>|</span>
        <span class='comment val'># { &quot;name&quot; =&gt; &quot;...&quot;, &quot;gateway&quot; =&gt; &quot;...&quot;, &quot;nodes&quot; =&gt; &quot;...&quot;,                                                                        </span>
          <span class='rubyid_case case kw'>case</span> <span class='rubyid_key identifier id'>key</span>
          <span class='rubyid_when when kw'>when</span> <span class='string val'>&quot;name&quot;</span>
            <span class='rubyid_resource_set identifier id'>resource_set</span><span class='dot token'>.</span><span class='rubyid_name identifier id'>name</span> <span class='assign token'>=</span> <span class='rubyid_value identifier id'>value</span>
          <span class='comment val'>#when &quot;gateway&quot;                                                                                                                 </span>
          <span class='comment val'>#  resource_set.properties[:gateway] = value                                                                                    </span>
          <span class='rubyid_when when kw'>when</span> <span class='string val'>&quot;nodes&quot;</span>
            <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_node identifier id'>node</span><span class='bitor op'>|</span>
              <span class='rubyid_resource identifier id'>resource</span> <span class='assign token'>=</span> <span class='rubyid_Resource constant id'>Resource</span><span class='colon2 op'>::</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:node</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_node identifier id'>node</span><span class='rparen token'>)</span>
              <span class='comment val'># here we must construct gateway's name in place                                                                            </span>
              <span class='rubyid_gw identifier id'>gw</span> <span class='assign token'>=</span> <span class='regexp val'>/\w*\.(\w+)\.\w*/</span><span class='dot token'>.</span><span class='rubyid_match identifier id'>match</span><span class='lparen token'>(</span><span class='rubyid_node identifier id'>node</span><span class='rparen token'>)</span>
              <span class='rubyid_gateway identifier id'>gateway</span> <span class='assign token'>=</span> <span class='string val'>&quot;frontend.&quot;</span><span class='plus op'>+</span><span class='rubyid_gw identifier id'>gw</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='plus op'>+</span><span class='string val'>&quot;.grid5000.fr&quot;</span>
              <span class='rubyid_resource identifier id'>resource</span><span class='dot token'>.</span><span class='rubyid_properties identifier id'>properties</span><span class='lbrack token'>[</span><span class='symbol val'>:site</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_gw identifier id'>gw</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span>
              <span class='rubyid_resource_set identifier id'>resource_set</span><span class='dot token'>.</span><span class='rubyid_properties identifier id'>properties</span><span class='lbrack token'>[</span><span class='symbol val'>:site</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_gw identifier id'>gw</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span>
              <span class='rubyid_resource identifier id'>resource</span><span class='dot token'>.</span><span class='rubyid_properties identifier id'>properties</span><span class='lbrack token'>[</span><span class='symbol val'>:gateway</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_gateway identifier id'>gateway</span>
              <span class='rubyid_resource_set identifier id'>resource_set</span><span class='dot token'>.</span><span class='rubyid_properties identifier id'>properties</span><span class='lbrack token'>[</span><span class='symbol val'>:gateway</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_gateway identifier id'>gateway</span>
              <span class='rubyid_resource_set identifier id'>resource_set</span><span class='dot token'>.</span><span class='rubyid_push identifier id'>push</span><span class='lparen token'>(</span><span class='rubyid_resource identifier id'>resource</span><span class='rparen token'>)</span>
          <span class='rbrace token'>}</span>
          <span class='rubyid_end end kw'>end</span>
      <span class='rbrace token'>}</span>
        <span class='rubyid_$all gvar id'>$all</span><span class='dot token'>.</span><span class='rubyid_push identifier id'>push</span><span class='lparen token'>(</span><span class='rubyid_resource_set identifier id'>resource_set</span><span class='rparen token'>)</span>
    <span class='rbrace token'>}</span>
  <span class='rbrace token'>}</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="g5k_init-instance_method">
  
    - (<tt>Object</tt>) <strong>g5k_init</strong>(experim_params) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>sets up the reservation parameters</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/g5k_api_old.rb', line 72</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_g5k_init identifier id'>g5k_init</span><span class='lparen token'>(</span><span class='rubyid_experim_params identifier id'>experim_params</span><span class='rparen token'>)</span>
  <span class='comment val'># make logger easier to access</span>
  <span class='rubyid_@logger ivar id'>@logger</span> <span class='assign token'>=</span> <span class='rubyid_$options gvar id'>$options</span><span class='lbrack token'>[</span><span class='symbol val'>:logger</span><span class='rbrack token'>]</span>
  
  <span class='comment val'># DO WE NEED IT???</span>
  <span class='rubyid_@nodes ivar id'>@nodes</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>

  <span class='rubyid_@resources ivar id'>@resources</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>

  <span class='rubyid_@jobs ivar id'>@jobs</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='rubyid_@deployments ivar id'>@deployments</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='rubyid_@mutex ivar id'>@mutex</span> <span class='assign token'>=</span> <span class='rubyid_Mutex constant id'>Mutex</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>

  <span class='rubyid_experim_params identifier id'>experim_params</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_attribute identifier id'>attribute</span><span class='comma token'>,</span> <span class='rubyid_value identifier id'>value</span><span class='bitor op'>|</span>
    <span class='rubyid_$options gvar id'>$options</span><span class='lbrack token'>[</span><span class='rubyid_attribute identifier id'>attribute</span><span class='dot token'>.</span><span class='rubyid_to_sym identifier id'>to_sym</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_value identifier id'>value</span>
  <span class='rbrace token'>}</span>

  <span class='rubyid_if if kw'>if</span> <span class='rubyid_$options gvar id'>$options</span><span class='dot token'>.</span><span class='rubyid_has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='symbol val'>:environment</span><span class='rparen token'>)</span>
    <span class='rubyid_$options gvar id'>$options</span><span class='lbrack token'>[</span><span class='symbol val'>:types</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_push identifier id'>push</span><span class='lparen token'>(</span><span class='string val'>&quot;deploy&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="g5k_reserve-instance_method">
  
    - (<tt>Object</tt>) <strong>g5k_reserve</strong>(options) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>reserve the remote nodes with parameters specified in $options</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


215
216
217
218
219
220
221</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/g5k_api_old.rb', line 215</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_g5k_reserve identifier id'>g5k_reserve</span><span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span><span class='rparen token'>)</span>

<span class='rubyid_logger identifier id'>logger</span> <span class='assign token'>=</span> <span class='rubyid_@logger ivar id'>@logger</span>

<span class='comment val'># payload is a hash contatining all the params of the job to submitgqqq  payload = {</span>
  <span class='symbol val'>:command</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;sleep #{$options[:walltime]}&quot;</span>
<span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_merge identifier id'>merge</span><span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span><span class='dot token'>.</span><span class='rubyid_reject identifier id'>reject</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_k identifier id'>k</span><span class='comma token'>,</span><span class='rubyid_v identifier id'>v</span><span class='bitor op'>|</span> <span class='notop op'>!</span><span class='rubyid_valid_job_key? fid id'>valid_job_key?</span><span class='lparen token'>(</span><span class='rubyid_k identifier id'>k</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span><span class='rparen token'>)</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="g5k_run-instance_method">
  
    - (<tt>Object</tt>) <strong>g5k_run</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>run reservation and deployment</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/g5k_api_old.rb', line 95</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_g5k_run identifier id'>g5k_run</span>

  <span class='comment val'>#------------RESERVATION STAGE--------------------------------</span>
  <span class='comment val'># if :sites == &quot;all&quot; reserve on each site</span>
  <span class='comment val'># if :sites == &quot;any&quot; - on the site w/ the biggest number of free nodes</span>
  <span class='comment val'># otherwise reserve on the specified site(s)</span>
  <span class='rubyid_if if kw'>if</span> <span class='lbrack token'>[</span><span class='string val'>&quot;all&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;any&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_$options gvar id'>$options</span><span class='lbrack token'>[</span><span class='symbol val'>:site</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rparen token'>)</span>
    <span class='rubyid_status identifier id'>status</span> <span class='assign token'>=</span> <span class='rubyid_how_many? fid id'>how_many?</span>
    <span class='rubyid_@logger ivar id'>@logger</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='dstring node'>&quot;Status=#{status.inspect}&quot;</span>
    <span class='rubyid_case case kw'>case</span> <span class='rubyid_$options gvar id'>$options</span><span class='lbrack token'>[</span><span class='symbol val'>:site</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span>
    <span class='rubyid_when when kw'>when</span> <span class='string val'>&quot;all&quot;</span>
      <span class='rubyid_@sites ivar id'>@sites</span> <span class='assign token'>=</span> <span class='rubyid_status identifier id'>status</span><span class='dot token'>.</span><span class='rubyid_keys identifier id'>keys</span>
    <span class='rubyid_when when kw'>when</span> <span class='string val'>&quot;any&quot;</span>
      <span class='rubyid_@sites ivar id'>@sites</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rubyid_status identifier id'>status</span><span class='dot token'>.</span><span class='rubyid_sort_by identifier id'>sort_by</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_k identifier id'>k</span><span class='comma token'>,</span><span class='rubyid_v identifier id'>v</span><span class='bitor op'>|</span> <span class='rubyid_v identifier id'>v</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_last identifier id'>last</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='rubyid_@sites ivar id'>@sites</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rubyid_$options gvar id'>$options</span><span class='lbrack token'>[</span><span class='symbol val'>:site</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_flatten identifier id'>flatten</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='comment val'># to keep track how many resource on each site to reserve</span>
  <span class='rubyid_@res ivar id'>@res</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rubyid_$options gvar id'>$options</span><span class='lbrack token'>[</span><span class='symbol val'>:resources</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_flatten identifier id'>flatten</span>
  <span class='comment val'>#In case we define the same number of nodes in each site.</span>
  <span class='rubyid_@res ivar id'>@res</span> <span class='assign token'>=</span> <span class='rubyid_@res ivar id'>@res</span><span class='mult op'>*</span><span class='rubyid_@sites ivar id'>@sites</span><span class='dot token'>.</span><span class='rubyid_length identifier id'>length</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_@res ivar id'>@res</span><span class='dot token'>.</span><span class='rubyid_length identifier id'>length</span><span class='eq op'>==</span><span class='integer val'>1</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_@sites ivar id'>@sites</span><span class='dot token'>.</span><span class='rubyid_length identifier id'>length</span><span class='gt op'>&gt;</span><span class='integer val'>1</span> 

  <span class='rubyid_$options gvar id'>$options</span><span class='lbrack token'>[</span><span class='symbol val'>:parallel_reserve</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_parallel identifier id'>parallel</span>
  <span class='comment val'># launch parallel reservations on all the $options[:site]</span>
  <span class='rubyid_for for kw'>for</span> <span class='rubyid_i identifier id'>i</span> <span class='rubyid_in in kw'>in</span> <span class='float val'>1</span><span class='dot2 op'>..</span><span class='rubyid_@sites ivar id'>@sites</span><span class='dot token'>.</span><span class='rubyid_length identifier id'>length</span>
    <span class='rubyid_$options gvar id'>$options</span><span class='lbrack token'>[</span><span class='symbol val'>:parallel_reserve</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_add identifier id'>add</span><span class='lparen token'>(</span><span class='rubyid_$options gvar id'>$options</span><span class='dot token'>.</span><span class='rubyid_merge identifier id'>merge</span><span class='lparen token'>(</span><span class='symbol val'>:site</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_@sites ivar id'>@sites</span><span class='lbrack token'>[</span><span class='rubyid_i identifier id'>i</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:resources</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_@res ivar id'>@res</span><span class='lbrack token'>[</span><span class='rubyid_i identifier id'>i</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_env identifier id'>env</span><span class='bitor op'>|</span>
      <span class='rubyid_g5k_reserve identifier id'>g5k_reserve</span><span class='lparen token'>(</span><span class='rubyid_env identifier id'>env</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='comment val'># wait till all the reservations complete</span>
  <span class='rubyid_$options gvar id'>$options</span><span class='lbrack token'>[</span><span class='symbol val'>:parallel_reserve</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_loop! fid id'>loop!</span>


  <span class='comment val'>#</span>
  <span class='comment val'># construct $all ResourceSet</span>
  <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_extract_resources_new identifier id'>extract_resources_new</span><span class='lparen token'>(</span><span class='rubyid_@resources ivar id'>@resources</span><span class='rparen token'>)</span>
  <span class='comment val'># I think that here is a good point to add the parameters of the reservation to the log</span>
  <span class='comment val'>#@reservations.push(0)</span>


  <span class='comment val'>#------------DEPLOYMENT STAGE--------------------------------</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_$options gvar id'>$options</span><span class='lbrack token'>[</span><span class='symbol val'>:types</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='string val'>&quot;deploy&quot;</span><span class='rparen token'>)</span>

    <span class='comment val'># create the environment hash: {&quot;environment_1&quot; =&gt; [&quot;node_1&quot;, ..], ...}</span>
    <span class='rubyid_env_hash identifier id'>env_hash</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='comment val'>#all_copy = $all.copy</span>
    <span class='rubyid_all_2 identifier id'>all_2</span> <span class='assign token'>=</span> <span class='rubyid_ResourceSet constant id'>ResourceSet</span><span class='colon2 op'>::</span><span class='rubyid_new identifier id'>new</span>
    <span class='rubyid_i identifier id'>i</span> <span class='assign token'>=</span> <span class='integer val'>0</span>

    <span class='rubyid_$options gvar id'>$options</span><span class='lbrack token'>[</span><span class='symbol val'>:environment</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_env identifier id'>env</span><span class='comma token'>,</span> <span class='rubyid_nodes_num identifier id'>nodes_num</span><span class='bitor op'>|</span>
      <span class='rubyid_env_hash identifier id'>env_hash</span><span class='lbrack token'>[</span><span class='rubyid_env identifier id'>env</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
      <span class='rubyid_nodes_num identifier id'>nodes_num</span><span class='dot token'>.</span><span class='rubyid_times identifier id'>times</span> <span class='lbrace token'>{</span>
        
        <span class='rubyid_all_check identifier id'>all_check</span> <span class='assign token'>=</span> <span class='rubyid_$all gvar id'>$all</span><span class='dot token'>.</span><span class='rubyid_copy identifier id'>copy</span>
        <span class='comment val'># find the node where env should be deployed and delete it</span>
        <span class='rubyid_$all gvar id'>$all</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_node identifier id'>node</span><span class='bitor op'>|</span>
          <span class='rubyid_if if kw'>if</span> <span class='rubyid_node identifier id'>node</span><span class='dot token'>.</span><span class='rubyid_corresponds identifier id'>corresponds</span><span class='lparen token'>(</span><span class='lbrace token'>{</span><span class='symbol val'>:site</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_$options gvar id'>$options</span><span class='lbrack token'>[</span><span class='symbol val'>:site</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='rubyid_i identifier id'>i</span><span class='rbrack token'>]</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
            <span class='rubyid_$all gvar id'>$all</span><span class='dot token'>.</span><span class='rubyid_delete identifier id'>delete</span><span class='lparen token'>(</span><span class='rubyid_node identifier id'>node</span><span class='rparen token'>)</span>
            <span class='rubyid_node identifier id'>node</span><span class='dot token'>.</span><span class='rubyid_properties identifier id'>properties</span><span class='lbrack token'>[</span><span class='symbol val'>:environment</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_env identifier id'>env</span>
            <span class='rubyid_all_2 identifier id'>all_2</span><span class='dot token'>.</span><span class='rubyid_push identifier id'>push</span><span class='lparen token'>(</span><span class='rubyid_node identifier id'>node</span><span class='rparen token'>)</span>
            <span class='rubyid_env_hash identifier id'>env_hash</span><span class='lbrack token'>[</span><span class='rubyid_env identifier id'>env</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_push identifier id'>push</span><span class='lparen token'>(</span><span class='rubyid_node identifier id'>node</span><span class='dot token'>.</span><span class='rubyid_properties identifier id'>properties</span><span class='lbrack token'>[</span><span class='symbol val'>:name</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
            <span class='rubyid_break break kw'>break</span>
          <span class='rubyid_end end kw'>end</span>
        <span class='rbrace token'>}</span>

        <span class='rubyid_if if kw'>if</span> <span class='rubyid_all_check identifier id'>all_check</span> <span class='eq op'>==</span> <span class='rubyid_$all gvar id'>$all</span>        <span class='comment val'>#nothing was deleted from $all</span>
          <span class='comment val'># take the next site and find again</span>
          <span class='rubyid_i identifier id'>i</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span> 
          <span class='rubyid_$all gvar id'>$all</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_node identifier id'>node</span><span class='bitor op'>|</span>
            <span class='rubyid_if if kw'>if</span> <span class='rubyid_node identifier id'>node</span><span class='dot token'>.</span><span class='rubyid_corresponds identifier id'>corresponds</span><span class='lparen token'>(</span><span class='lbrace token'>{</span><span class='symbol val'>:site</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_$options gvar id'>$options</span><span class='lbrack token'>[</span><span class='symbol val'>:site</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='rubyid_i identifier id'>i</span><span class='rbrack token'>]</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
              <span class='rubyid_$all gvar id'>$all</span><span class='dot token'>.</span><span class='rubyid_delete identifier id'>delete</span><span class='lparen token'>(</span><span class='rubyid_node identifier id'>node</span><span class='rparen token'>)</span>
              <span class='rubyid_node identifier id'>node</span><span class='dot token'>.</span><span class='rubyid_properties identifier id'>properties</span><span class='lbrack token'>[</span><span class='symbol val'>:environment</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_env identifier id'>env</span>
              <span class='rubyid_all_2 identifier id'>all_2</span><span class='dot token'>.</span><span class='rubyid_push identifier id'>push</span><span class='lparen token'>(</span><span class='rubyid_node identifier id'>node</span><span class='rparen token'>)</span>
              <span class='rubyid_env_hash identifier id'>env_hash</span><span class='lbrack token'>[</span><span class='rubyid_env identifier id'>env</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_push identifier id'>push</span><span class='lparen token'>(</span><span class='rubyid_node identifier id'>node</span><span class='dot token'>.</span><span class='rubyid_properties identifier id'>properties</span><span class='lbrack token'>[</span><span class='symbol val'>:name</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
              <span class='rubyid_break break kw'>break</span>
            <span class='rubyid_end end kw'>end</span>
          <span class='rbrace token'>}</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rbrace token'>}</span>
    <span class='rbrace token'>}</span>
    <span class='comment val'># each resource now has :environment property</span>
    <span class='rubyid_$all gvar id'>$all</span> <span class='assign token'>=</span> <span class='rubyid_all_2 identifier id'>all_2</span>


    <span class='comment val'># launch parallel deployments for each environment</span>
    <span class='rubyid_$options gvar id'>$options</span><span class='lbrack token'>[</span><span class='symbol val'>:parallel_deploy</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_parallel identifier id'>parallel</span>

    <span class='comment val'># As API deploy the same environment on the same site in parallel, </span>
    <span class='comment val'># we submit deployments in</span>
    <span class='comment val'># &quot;environment_1&quot; =&gt; [ .. all the nodes of the site ]</span>
    <span class='comment val'># for each site</span>

    <span class='rubyid_$options gvar id'>$options</span><span class='lbrack token'>[</span><span class='symbol val'>:site</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_site identifier id'>site</span><span class='bitor op'>|</span>
      
      <span class='rubyid_env_hash identifier id'>env_hash</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_environment identifier id'>environment</span><span class='comma token'>,</span> <span class='rubyid_nodes identifier id'>nodes</span><span class='bitor op'>|</span>
        
        <span class='rubyid_$options gvar id'>$options</span><span class='lbrack token'>[</span><span class='symbol val'>:environment</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_environment identifier id'>environment</span>
        <span class='comment val'># find all the reserved nodes from this site</span>
        <span class='rubyid_$options gvar id'>$options</span><span class='lbrack token'>[</span><span class='symbol val'>:nodes</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_nodes identifier id'>nodes</span><span class='dot token'>.</span><span class='rubyid_find_all identifier id'>find_all</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_node identifier id'>node</span><span class='bitor op'>|</span>
          <span class='rubyid_node identifier id'>node</span> <span class='match op'>=~</span> <span class='dregexp node'>/\S*.#{site}.\w*/</span>
        <span class='rbrace token'>}</span>

        <span class='rubyid_if if kw'>if</span> <span class='rubyid_not not kw'>not</span> <span class='rubyid_$options gvar id'>$options</span><span class='lbrack token'>[</span><span class='symbol val'>:nodes</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
          <span class='rubyid_$options gvar id'>$options</span><span class='lbrack token'>[</span><span class='symbol val'>:parallel_deploy</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_add identifier id'>add</span><span class='lparen token'>(</span><span class='rubyid_$options gvar id'>$options</span><span class='dot token'>.</span><span class='rubyid_merge identifier id'>merge</span><span class='lparen token'>(</span><span class='symbol val'>:site</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_site identifier id'>site</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_env identifier id'>env</span><span class='bitor op'>|</span>
            <span class='rubyid_g5k_deploy identifier id'>g5k_deploy</span><span class='lparen token'>(</span><span class='rubyid_env identifier id'>env</span><span class='rparen token'>)</span>
          <span class='rbrace token'>}</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rbrace token'>}</span>
    <span class='rbrace token'>}</span>

    <span class='comment val'>#wait for all the deployments to finish</span>
    <span class='rubyid_$options gvar id'>$options</span><span class='lbrack token'>[</span><span class='symbol val'>:parallel_deploy</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_loop! fid id'>loop!</span>
  <span class='rubyid_end end kw'>end</span>

<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get-instance_method">
  
    - (<tt>Object</tt>) <strong>get</strong>(file, source, params = {}) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/expolib.rb', line 191</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_get identifier id'>get</span><span class='lparen token'>(</span> <span class='rubyid_file identifier id'>file</span><span class='comma token'>,</span> <span class='rubyid_source identifier id'>source</span><span class='comma token'>,</span> <span class='rubyid_params identifier id'>params</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span> <span class='rparen token'>)</span>

  <span class='rubyid_if if kw'>if</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:path</span><span class='rbrack token'>]</span> <span class='rubyid_then then kw'>then</span>
    <span class='rubyid_path identifier id'>path</span> <span class='assign token'>=</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:path</span><span class='rbrack token'>]</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='rubyid_path identifier id'>path</span> <span class='assign token'>=</span> <span class='rubyid_file identifier id'>file</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_$ssh_user gvar id'>$ssh_user</span><span class='assign token'>=</span><span class='string val'>&quot;root&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_$ssh_user gvar id'>$ssh_user</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>  <span class='comment val'>### temporary user manage</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='assign token'>=</span> <span class='string val'>&quot;scp &quot;</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot; &quot;</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;#{$ssh_user}@&quot;</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;#{source}:&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='lparen token'>(</span> <span class='rubyid_destination identifier id'>destination</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span> <span class='neq op'>!=</span> <span class='string val'>&quot;localhost&quot;</span> <span class='rparen token'>)</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;#{file} &quot;</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; #{path}&quot;</span>
  <span class='rubyid_command_result identifier id'>command_result</span> <span class='assign token'>=</span> <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_asynchronous_command identifier id'>asynchronous_command</span><span class='lparen token'>(</span><span class='rubyid_cmd identifier id'>cmd</span><span class='rparen token'>)</span>
  <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_command_wait identifier id'>command_wait</span><span class='lparen token'>(</span><span class='rubyid_command_result identifier id'>command_result</span><span class='lbrack token'>[</span><span class='string val'>&quot;command_number&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='rubyid_final_result identifier id'>final_result</span> <span class='assign token'>=</span> <span class='rubyid_make_task_result identifier id'>make_task_result</span><span class='lparen token'>(</span><span class='rubyid_command_result identifier id'>command_result</span><span class='lbrack token'>[</span><span class='string val'>&quot;command_number&quot;</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>

  <span class='rubyid_log_file_mgt identifier id'>log_file_mgt</span><span class='lparen token'>(</span><span class='rubyid_file identifier id'>file</span><span class='comma token'>,</span><span class='rubyid_final_result identifier id'>final_result</span><span class='comma token'>,</span><span class='string val'>&quot;GET&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_return return kw'>return</span> <span class='rubyid_final_result identifier id'>final_result</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_results-instance_method">
  
    - (<tt>Object</tt>) <strong>get_results</strong>(targets, file, where = &quot;~/&quot;) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/expolib.rb', line 340</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_get_results identifier id'>get_results</span><span class='lparen token'>(</span><span class='rubyid_targets identifier id'>targets</span><span class='comma token'>,</span> <span class='rubyid_file identifier id'>file</span><span class='comma token'>,</span> <span class='rubyid_where identifier id'>where</span><span class='assign token'>=</span><span class='string val'>&quot;~/&quot;</span><span class='rparen token'>)</span>
    <span class='rubyid_$ssh_user gvar id'>$ssh_user</span><span class='assign token'>=</span><span class='string val'>&quot;root&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_$ssh_user gvar id'>$ssh_user</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
 
    <span class='comment val'>#### this function gets the results from a set of nodes. </span>
    <span class='comment val'>### for the moment is sequentially so it has not good performance</span>
  
    <span class='rubyid_targets identifier id'>targets</span><span class='dot token'>.</span><span class='rubyid_flatten identifier id'>flatten</span><span class='lparen token'>(</span><span class='symbol val'>:node</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span><span class='lparen token'>(</span><span class='symbol val'>:node</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_node identifier id'>node</span><span class='bitor op'>|</span>
    
      <span class='rubyid_cmd identifier id'>cmd</span> <span class='assign token'>=</span> <span class='string val'>&quot;ssh &quot;</span>
      <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot; &quot;</span>
      <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;#{$ssh_user}@#{node}&quot;</span>
      <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; ls #{file} &quot;</span> <span class='comment val'>#it looks temporary in the home directory</span>
      <span class='rubyid_command_result identifier id'>command_result</span> <span class='assign token'>=</span> <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_asynchronous_command identifier id'>asynchronous_command</span><span class='lparen token'>(</span><span class='rubyid_cmd identifier id'>cmd</span><span class='rparen token'>)</span>
      <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_command_wait identifier id'>command_wait</span><span class='lparen token'>(</span><span class='rubyid_command_result identifier id'>command_result</span><span class='lbrack token'>[</span><span class='string val'>&quot;command_number&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='integer val'>1</span><span class='rparen token'>)</span>
      <span class='rubyid_result identifier id'>result</span> <span class='assign token'>=</span> <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_command_result identifier id'>command_result</span><span class='lparen token'>(</span><span class='rubyid_command_result identifier id'>command_result</span><span class='lbrack token'>[</span><span class='string val'>&quot;command_number&quot;</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      <span class='rubyid_puts identifier id'>puts</span> <span class='rubyid_cmd identifier id'>cmd</span>
      <span class='rubyid_puts identifier id'>puts</span> <span class='rubyid_result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>&quot;stdout&quot;</span><span class='rbrack token'>]</span>
      <span class='rubyid_files_to_trans identifier id'>files_to_trans</span> <span class='assign token'>=</span> <span class='rubyid_result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>&quot;stdout&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_split identifier id'>split</span><span class='lparen token'>(</span><span class='rparen token'>)</span>
      <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Number of files to trasfer for this node: #{files_to_trans.length}&quot;</span>
    
      <span class='rubyid_files_to_trans identifier id'>files_to_trans</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_current_file identifier id'>current_file</span><span class='bitor op'>|</span>
  
          <span class='rubyid_file_base identifier id'>file_base</span><span class='assign token'>=</span><span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_basename identifier id'>basename</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{current_file}&quot;</span><span class='rparen token'>)</span>
      <span class='rubyid_cmd identifier id'>cmd</span> <span class='assign token'>=</span> <span class='string val'>&quot;scp &quot;</span>
  <span class='comment val'>#cmd += $scp_connector # == -o StrictHostKeyChecking=no</span>
      <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot; &quot;</span>
      <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;#{$ssh_user}@#{node}:&quot;</span>
      <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;#{current_file}&quot;</span>
      <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; #{where}/#{file_base}-#{node}&quot;</span>
    <span class='rubyid_command_result identifier id'>command_result</span> <span class='assign token'>=</span> <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_asynchronous_command identifier id'>asynchronous_command</span><span class='lparen token'>(</span><span class='rubyid_cmd identifier id'>cmd</span><span class='rparen token'>)</span>
      <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_command_wait identifier id'>command_wait</span><span class='lparen token'>(</span><span class='rubyid_command_result identifier id'>command_result</span><span class='lbrack token'>[</span><span class='string val'>&quot;command_number&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='integer val'>1</span><span class='rparen token'>)</span>
      <span class='rubyid_result identifier id'>result</span> <span class='assign token'>=</span> <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_command_result identifier id'>command_result</span><span class='lparen token'>(</span><span class='rubyid_command_result identifier id'>command_result</span><span class='lbrack token'>[</span><span class='string val'>&quot;command_number&quot;</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='rubyid_puts identifier id'>puts</span> <span class='rubyid_cmd identifier id'>cmd</span>
      <span class='rubyid_puts identifier id'>puts</span> <span class='rubyid_result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>&quot;stdout&quot;</span><span class='rbrack token'>]</span>
      <span class='rubyid_puts identifier id'>puts</span> <span class='rubyid_result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>&quot;stderr&quot;</span><span class='rbrack token'>]</span>
        <span class='rbrace token'>}</span>
    <span class='rbrace token'>}</span>
    <span class='comment val'>#cmd += &quot;</span>
    <span class='comment val'>#puts result[&quot;stderr&quot;]</span>
    <span class='comment val'>#puts file.class</span>
  
    <span class='comment val'>### now the file has to be brought with taktuk</span>
  <span class='comment val'>#----means that 'location' node will start all other nodes. For</span>
  <span class='comment val'>#----details see 2.2.2 section of Taktuk manual</span>

   <span class='comment val'>#files_to_trans.each{ |current_file|</span>
    <span class='comment val'>#cmd = &quot;ruby taktuk2yaml.rb -s&quot;</span>
    <span class='comment val'>#cmd += $ssh_connector</span>
     <span class='comment val'>#cmd += &quot; -l #{$ssh_user}&quot; if !$ssh_user.nil?</span>
     <span class='comment val'>#targets.flatten(:node).each(:node) { |node|</span>

     <span class='comment val'>#cmd += &quot; -m #{node}&quot;</span>
     <span class='comment val'>#}</span>
     <span class='comment val'>#puts &quot;file to get #{current_file}&quot;</span>
     <span class='comment val'>#file_base=File.basename(&quot;#{current_file}&quot;)</span>
     <span class='comment val'>#cmd += &quot; broadcast get [ '#{current_file}' ] [ '#{where}/#{file_base}-$rank' ]&quot;</span>
  <span class='comment val'>#cmd += &quot; -]&quot;</span>
     <span class='comment val'>#puts &quot;command Executed #{cmd}&quot;</span>
     <span class='comment val'>#command_result = $client.asynchronous_command(cmd)</span>
     <span class='comment val'>#$client.command_wait(command_result[&quot;command_number&quot;],1)</span>
     <span class='comment val'>#result = $client.command_result(command_result[&quot;command_number&quot;])</span>
      <span class='comment val'>#puts result[&quot;stdout&quot;]</span>
    <span class='comment val'>#}</span>
  <span class='comment val'>#----here we return two values: id of a command and a hash 'res' where</span>
  <span class='comment val'>#----all the info about the command is stored</span>
  <span class='comment val'>#return make_taktuk_result(command_result[&quot;command_number&quot;])</span>

<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="log_file_mgt-instance_method">
  
    - (<tt>Object</tt>) <strong>log_file_mgt</strong>(file, result_with_id, type) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>logging File managment ################</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/expolib.rb', line 71</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_log_file_mgt identifier id'>log_file_mgt</span><span class='lparen token'>(</span><span class='rubyid_file identifier id'>file</span><span class='comma token'>,</span><span class='rubyid_result_with_id identifier id'>result_with_id</span><span class='comma token'>,</span><span class='rubyid_type identifier id'>type</span><span class='rparen token'>)</span>
  <span class='rubyid_id identifier id'>id</span> <span class='assign token'>=</span> <span class='rubyid_result_with_id identifier id'>result_with_id</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
  <span class='rubyid_result identifier id'>result</span><span class='assign token'>=</span><span class='rubyid_result_with_id identifier id'>result_with_id</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span>
  <span class='rubyid_file_log_msg identifier id'>file_log_msg</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;[ #{type} File:#{id} ] &quot;</span>
  
  <span class='comment val'># Note status for this case if a Int but when the output is parsed from</span>
  <span class='comment val'># taktuk wrapper is a String</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'status'</span><span class='rbrack token'>]</span> <span class='neq op'>!=</span> <span class='integer val'>0</span> <span class='rubyid_then then kw'>then</span>
    <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_error identifier id'>error</span> <span class='rubyid_file_log_msg identifier id'>file_log_msg</span><span class='plus op'>+</span><span class='dstring node'>&quot; [ Error with File ] #{file} &quot;</span>
    <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_error identifier id'>error</span> <span class='rubyid_file_log_msg identifier id'>file_log_msg</span><span class='plus op'>+</span><span class='dstring node'>&quot; [ On Node ] #{result['host_name']} &quot;</span>
    <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_error identifier id'>error</span> <span class='rubyid_file_log_msg identifier id'>file_log_msg</span><span class='plus op'>+</span><span class='dstring node'>&quot; [ Elapsed Time ] #{result.duration} secs&quot;</span>
    <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_data_logger identifier id'>data_logger</span><span class='dot token'>.</span><span class='rubyid_error identifier id'>error</span> <span class='rubyid_file_log_msg identifier id'>file_log_msg</span>
    <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_data_logger identifier id'>data_logger</span><span class='dot token'>.</span><span class='rubyid_error identifier id'>error</span> <span class='rubyid_file identifier id'>file</span>
    <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_data_logger identifier id'>data_logger</span><span class='dot token'>.</span><span class='rubyid_error identifier id'>error</span> <span class='rubyid_result identifier id'>result</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='rubyid_file_log_msg identifier id'>file_log_msg</span><span class='plus op'>+</span><span class='dstring node'>&quot; [ File Success ] #{file} &quot;</span>
    <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='rubyid_file_log_msg identifier id'>file_log_msg</span><span class='plus op'>+</span><span class='dstring node'>&quot; [ On Node ] #{result['host_name']} &quot;</span>
    <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='rubyid_file_log_msg identifier id'>file_log_msg</span><span class='plus op'>+</span><span class='dstring node'>&quot; [ Elapsed Time ] #{result.duration} secs&quot;</span>
    <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_data_logger identifier id'>data_logger</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='rubyid_file_log_msg identifier id'>file_log_msg</span>
    <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_data_logger identifier id'>data_logger</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='rubyid_file identifier id'>file</span>
    <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_data_logger identifier id'>data_logger</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='rubyid_result identifier id'>result</span>

  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="log_task-instance_method">
  
    - (<tt>Object</tt>) <strong>log_task</strong>(command, result_with_id, type) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>loggin’ tasks #############</p>
<dl class="rdoc-list label-list"><dt> &lt;LogActor&gt; 
<dd><dl class="rdoc-list label-list"><dt> &lt;LogSubject&gt; 
<dd>
<p>&lt;LogMessage&gt;</p>
</dd></dl>
</dd><dt> Task:ID 
<dd><dl class="rdoc-list label-list"><dt> Action 
<dd>
<p>Message</p>
</dd></dl>
</dd></dl>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/expolib.rb', line 42</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_log_task identifier id'>log_task</span><span class='lparen token'>(</span><span class='rubyid_command identifier id'>command</span><span class='comma token'>,</span><span class='rubyid_result_with_id identifier id'>result_with_id</span><span class='comma token'>,</span><span class='rubyid_type identifier id'>type</span><span class='rparen token'>)</span>
  
  <span class='rubyid_id identifier id'>id</span> <span class='assign token'>=</span> <span class='rubyid_result_with_id identifier id'>result_with_id</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
  <span class='rubyid_result identifier id'>result</span><span class='assign token'>=</span><span class='rubyid_result_with_id identifier id'>result_with_id</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span>
  <span class='comment val'>### looking for the state of the task executed</span>
  <span class='rubyid_task_log_msg identifier id'>task_log_msg</span><span class='assign token'>=</span><span class='dstring node'>&quot;[ #{type} Task:#{id} ] &quot;</span>

  <span class='rubyid_result identifier id'>result</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_indv identifier id'>indv</span><span class='bitor op'>|</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_indv identifier id'>indv</span><span class='lbrack token'>[</span><span class='string val'>'status'</span><span class='rbrack token'>]</span> <span class='neq op'>!=</span><span class='string val'>&quot;0&quot;</span> <span class='rubyid_then then kw'>then</span>
      <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_error identifier id'>error</span>  <span class='rubyid_task_log_msg identifier id'>task_log_msg</span> <span class='plus op'>+</span><span class='dstring node'>&quot; [ Error executing ] #{command} &quot;</span> 
      <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_error identifier id'>error</span>  <span class='rubyid_task_log_msg identifier id'>task_log_msg</span> <span class='plus op'>+</span><span class='dstring node'>&quot; [ On Node ] #{indv['host_name']} &quot;</span>
      <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_error identifier id'>error</span>  <span class='rubyid_task_log_msg identifier id'>task_log_msg</span> <span class='plus op'>+</span><span class='dstring node'>&quot; [ Elapsed Time ] #{indv.duration} secs&quot;</span>
      <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_data_logger identifier id'>data_logger</span><span class='dot token'>.</span><span class='rubyid_error identifier id'>error</span> <span class='rubyid_task_log_msg identifier id'>task_log_msg</span> 
      <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_data_logger identifier id'>data_logger</span><span class='dot token'>.</span><span class='rubyid_error identifier id'>error</span> <span class='rubyid_command identifier id'>command</span>
      <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_data_logger identifier id'>data_logger</span><span class='dot token'>.</span><span class='rubyid_error identifier id'>error</span> <span class='rubyid_indv identifier id'>indv</span>
    <span class='rubyid_else else kw'>else</span>
      <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span>  <span class='rubyid_task_log_msg identifier id'>task_log_msg</span><span class='plus op'>+</span><span class='dstring node'>&quot; [ Executed ]   #{command} &quot;</span> 
      <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span>  <span class='rubyid_task_log_msg identifier id'>task_log_msg</span><span class='plus op'>+</span><span class='dstring node'>&quot; [ On Node ]  #{indv['host_name']} &quot;</span>
      <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span>  <span class='rubyid_task_log_msg identifier id'>task_log_msg</span><span class='plus op'>+</span><span class='dstring node'>&quot; [ Elapsed Time ] #{indv.duration} secs&quot;</span>
      <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_data_logger identifier id'>data_logger</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='rubyid_task_log_msg identifier id'>task_log_msg</span>
      <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_data_logger identifier id'>data_logger</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='rubyid_command identifier id'>command</span>
      <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_data_logger identifier id'>data_logger</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='rubyid_indv identifier id'>indv</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rbrace token'>}</span>
  
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="make_taktuk_result-instance_method">
  
    - (<tt>Object</tt>) <strong>make_taktuk_result</strong>(id) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/expolib.rb', line 267</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_make_taktuk_result identifier id'>make_taktuk_result</span><span class='lparen token'>(</span> <span class='rubyid_id identifier id'>id</span> <span class='rparen token'>)</span>
  <span class='rubyid_result identifier id'>result</span> <span class='assign token'>=</span> <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_command_result identifier id'>command_result</span><span class='lparen token'>(</span> <span class='rubyid_id identifier id'>id</span> <span class='rparen token'>)</span>

  <span class='rubyid_tree identifier id'>tree</span> <span class='assign token'>=</span> <span class='rubyid_YAML constant id'>YAML</span><span class='colon2 op'>::</span><span class='rubyid_load identifier id'>load</span><span class='lparen token'>(</span><span class='rubyid_result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'stdout'</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>

  <span class='rubyid_res identifier id'>res</span> <span class='assign token'>=</span> <span class='rubyid_ExpoResult constant id'>ExpoResult</span><span class='colon2 op'>::</span><span class='rubyid_new identifier id'>new</span>
  <span class='rubyid_tree identifier id'>tree</span><span class='lbrack token'>[</span><span class='string val'>'hosts'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_each_value identifier id'>each_value</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_h identifier id'>h</span><span class='bitor op'>|</span>
    <span class='rubyid_h identifier id'>h</span><span class='lbrack token'>[</span><span class='string val'>'commands'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_each_value identifier id'>each_value</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_x identifier id'>x</span><span class='bitor op'>|</span>
      <span class='rubyid_r identifier id'>r</span> <span class='assign token'>=</span> <span class='rubyid_TaskResult constant id'>TaskResult</span><span class='colon2 op'>::</span><span class='rubyid_new identifier id'>new</span>
      <span class='rubyid_r identifier id'>r</span><span class='dot token'>.</span><span class='rubyid_merge! fid id'>merge!</span><span class='lparen token'>(</span> <span class='lbrace token'>{</span><span class='string val'>'host_name'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_h identifier id'>h</span><span class='lbrack token'>[</span><span class='string val'>'host_name'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> 
                  <span class='string val'>'rank'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_h identifier id'>h</span><span class='lbrack token'>[</span><span class='string val'>'rank'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> 
                  <span class='string val'>'command_line'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_x identifier id'>x</span><span class='lbrack token'>[</span><span class='string val'>'command_line'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> 
                  <span class='string val'>'stdout'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_x identifier id'>x</span><span class='lbrack token'>[</span><span class='string val'>'output'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> 
                  <span class='string val'>'stderr'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_x identifier id'>x</span><span class='lbrack token'>[</span><span class='string val'>'error'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> 
                  <span class='string val'>'status'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_x identifier id'>x</span><span class='lbrack token'>[</span><span class='string val'>'status'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> 
                  <span class='string val'>'start_time'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_x identifier id'>x</span><span class='lbrack token'>[</span><span class='string val'>'start_date'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> 
                  <span class='string val'>'end_time'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_x identifier id'>x</span><span class='lbrack token'>[</span><span class='string val'>'stop_date'</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span> <span class='rparen token'>)</span>
      <span class='rubyid_res identifier id'>res</span><span class='dot token'>.</span><span class='rubyid_push identifier id'>push</span><span class='lparen token'>(</span><span class='rubyid_r identifier id'>r</span><span class='rparen token'>)</span>
    <span class='rbrace token'>}</span>
  <span class='rbrace token'>}</span>

  <span class='comment val'>#----display an output of command!!!</span>
  <span class='comment val'>### Fix me ###</span>
  <span class='comment val'>### Error handling not implemented</span>
  <span class='rubyid_if if kw'>if</span><span class='lparen token'>(</span> <span class='rubyid_res identifier id'>res</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span><span class='rparen token'>)</span> <span class='rubyid_then then kw'>then</span>
  <span class='rubyid_puts identifier id'>puts</span> <span class='string val'>&quot;Error Contacting the node&quot;</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='comment val'>#puts &quot;Command: &quot; + res[0]['command_line']</span>
    <span class='comment val'>#puts &quot;Output: &quot;</span>
    <span class='rubyid_if if kw'>if</span> <span class='notop op'>!</span><span class='rubyid_res identifier id'>res</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>'stdout'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
        <span class='rubyid_puts identifier id'>puts</span> <span class='rubyid_res identifier id'>res</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>'stdout'</span><span class='rbrack token'>]</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>

 
  <span class='rubyid_return return kw'>return</span> <span class='lbrack token'>[</span><span class='rubyid_id identifier id'>id</span><span class='comma token'>,</span> <span class='rubyid_res identifier id'>res</span><span class='rbrack token'>]</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="make_task_result-instance_method">
  
    - (<tt>Object</tt>) <strong>make_task_result</strong>(id) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/expolib.rb', line 214</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_make_task_result identifier id'>make_task_result</span><span class='lparen token'>(</span><span class='rubyid_id identifier id'>id</span><span class='rparen token'>)</span>
  <span class='rubyid_result identifier id'>result</span> <span class='assign token'>=</span> <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_command_result identifier id'>command_result</span><span class='lparen token'>(</span> <span class='rubyid_id identifier id'>id</span> <span class='rparen token'>)</span>
  <span class='rubyid_result_rctrl identifier id'>result_rctrl</span> <span class='assign token'>=</span> <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_command_info identifier id'>command_info</span><span class='lparen token'>(</span> <span class='rubyid_id identifier id'>id</span> <span class='rparen token'>)</span>
  <span class='rubyid_r identifier id'>r</span> <span class='assign token'>=</span> <span class='rubyid_TaskResult constant id'>TaskResult</span><span class='colon2 op'>::</span><span class='rubyid_new identifier id'>new</span>
 
  <span class='rubyid_r identifier id'>r</span><span class='dot token'>.</span><span class='rubyid_merge! fid id'>merge!</span><span class='lparen token'>(</span> <span class='lbrace token'>{</span><span class='comment val'>#'host_name' =&gt; result['host_name'], </span>
           <span class='comment val'>#'rank' =&gt; result['rank'], </span>
           <span class='string val'>'command_line'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_result_rctrl identifier id'>result_rctrl</span><span class='lbrack token'>[</span><span class='string val'>'command_line'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> 
           <span class='string val'>'stdout'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'stdout'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> 
           <span class='string val'>'stderr'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'stderr'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> 
           <span class='string val'>'status'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'exit_status'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> 
           <span class='string val'>'start_time'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_result_rctrl identifier id'>result_rctrl</span><span class='lbrack token'>[</span><span class='string val'>'start_time'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> 
           <span class='string val'>'end_time'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_result_rctrl identifier id'>result_rctrl</span><span class='lbrack token'>[</span><span class='string val'>'end_time'</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span> 
          <span class='rparen token'>)</span>
  <span class='rubyid_return return kw'>return</span> <span class='lbrack token'>[</span><span class='rubyid_id identifier id'>id</span><span class='comma token'>,</span><span class='rubyid_r identifier id'>r</span><span class='rbrack token'>]</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="parallel_section-instance_method">
  
    - (<tt>Object</tt>) <strong>parallel_section</strong>(&amp;block) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


335
336
337</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/expolib.rb', line 335</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_parallel_section identifier id'>parallel_section</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='rubyid_block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='rubyid_ParallelSection constant id'>ParallelSection</span><span class='colon2 op'>::</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='rubyid_block identifier id'>block</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="print_taktuk_result-instance_method">
  
    - (<tt>Object</tt>) <strong>print_taktuk_result</strong>(res) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


306
307
308
309
310
311
312
313
314
315</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/expolib.rb', line 306</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_print_taktuk_result identifier id'>print_taktuk_result</span><span class='lparen token'>(</span> <span class='rubyid_res identifier id'>res</span> <span class='rparen token'>)</span>
  <span class='rubyid_res identifier id'>res</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_r identifier id'>r</span><span class='bitor op'>|</span>
    <span class='rubyid_puts identifier id'>puts</span> <span class='rubyid_r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'host_name'</span><span class='rbrack token'>]</span> <span class='plus op'>+</span> <span class='string val'>&quot; :&quot;</span>
    <span class='rubyid_puts identifier id'>puts</span> <span class='rubyid_r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'start_time'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span> <span class='plus op'>+</span> <span class='string val'>&quot; - &quot;</span> <span class='plus op'>+</span> <span class='rubyid_r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'end_time'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span> 
    <span class='rubyid_puts identifier id'>puts</span> <span class='rubyid_r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'command_line'</span><span class='rbrack token'>]</span><span class='semicolon token'>;</span>
    <span class='rubyid_puts identifier id'>puts</span> <span class='rubyid_r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'stdout'</span><span class='rbrack token'>]</span><span class='semicolon token'>;</span>
    <span class='rubyid_puts identifier id'>puts</span> <span class='rubyid_r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'stderr'</span><span class='rbrack token'>]</span><span class='semicolon token'>;</span>
    <span class='rubyid_puts identifier id'>puts</span>
  <span class='rbrace token'>}</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="ptask-instance_method">
  
    - (<tt>Object</tt>) <strong>ptask</strong>(targets, task) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/expolib.rb', line 139</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_ptask identifier id'>ptask</span><span class='lparen token'>(</span><span class='rubyid_targets identifier id'>targets</span><span class='comma token'>,</span> <span class='rubyid_task identifier id'>task</span><span class='rparen token'>)</span>
  
  <span class='rubyid_path identifier id'>path</span><span class='comma token'>,</span><span class='rubyid_exec identifier id'>exec</span><span class='comma token'>,</span><span class='rubyid_params identifier id'>params</span> <span class='assign token'>=</span> <span class='rubyid_treat_task identifier id'>treat_task</span> <span class='rubyid_task identifier id'>task</span>
  <span class='comment val'>#cmd = &quot;ruby taktuk2yaml.rb --connector /usr/bin/oarsh -s&quot;</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='assign token'>=</span> <span class='string val'>&quot;ruby taktuk2yaml.rb -s&quot;</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='rubyid_$ssh_connector gvar id'>$ssh_connector</span>
  <span class='comment val'>#----means that 'location' node will start all other nodes. For</span>
  <span class='comment val'>#----details see 2.2.2 section of Taktuk manual</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; -m #{targets.gateway}&quot;</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot; -[&quot;</span>
  <span class='rubyid_targets identifier id'>targets</span><span class='dot token'>.</span><span class='rubyid_flatten identifier id'>flatten</span><span class='lparen token'>(</span><span class='symbol val'>:node</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span><span class='lparen token'>(</span><span class='symbol val'>:node</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_node identifier id'>node</span><span class='bitor op'>|</span>
    <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; -m #{node}&quot;</span>
  <span class='rbrace token'>}</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; downcast exec [ 'cd #{path} ; #{exec} #{params}' ]&quot;</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot; -]&quot;</span>
  <span class='rubyid_command_result identifier id'>command_result</span> <span class='assign token'>=</span> <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_asynchronous_command identifier id'>asynchronous_command</span><span class='lparen token'>(</span><span class='rubyid_cmd identifier id'>cmd</span><span class='rparen token'>)</span>
  <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_command_wait identifier id'>command_wait</span><span class='lparen token'>(</span><span class='rubyid_command_result identifier id'>command_result</span><span class='lbrack token'>[</span><span class='string val'>&quot;command_number&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='comment val'>#----here we return two values: id of a command and a hash 'res' where</span>
  <span class='comment val'>#----all the info about the command is stored</span>
  <span class='rubyid_final_result identifier id'>final_result</span> <span class='assign token'>=</span> <span class='rubyid_make_taktuk_result identifier id'>make_taktuk_result</span><span class='lparen token'>(</span><span class='rubyid_command_result identifier id'>command_result</span><span class='lbrack token'>[</span><span class='string val'>&quot;command_number&quot;</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='rubyid_log_task identifier id'>log_task</span><span class='lparen token'>(</span><span class='rubyid_exec identifier id'>exec</span><span class='comma token'>,</span><span class='rubyid_final_result identifier id'>final_result</span><span class='comma token'>,</span><span class='string val'>&quot;Parallel&quot;</span><span class='rparen token'>)</span>

  <span class='rubyid_return return kw'>return</span> <span class='rubyid_final_result identifier id'>final_result</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="put-instance_method">
  
    - (<tt>Object</tt>) <strong>put</strong>(file, destination, params = {}) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/expolib.rb', line 165</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_put identifier id'>put</span><span class='lparen token'>(</span> <span class='rubyid_file identifier id'>file</span><span class='comma token'>,</span> <span class='rubyid_destination identifier id'>destination</span><span class='comma token'>,</span> <span class='rubyid_params identifier id'>params</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span> <span class='rparen token'>)</span>

  <span class='rubyid_if if kw'>if</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:path</span><span class='rbrack token'>]</span> <span class='rubyid_then then kw'>then</span>
    <span class='rubyid_path identifier id'>path</span> <span class='assign token'>=</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:path</span><span class='rbrack token'>]</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='rubyid_path identifier id'>path</span> <span class='assign token'>=</span> <span class='rubyid_file identifier id'>file</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_$ssh_user gvar id'>$ssh_user</span><span class='assign token'>=</span><span class='string val'>&quot;root&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_$ssh_user gvar id'>$ssh_user</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>  <span class='comment val'>### temporary user manage</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='assign token'>=</span> <span class='string val'>&quot;scp &quot;</span>
  <span class='comment val'>#cmd += $scp_connector # == -o StrictHostKeyChecking=no</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot; &quot;</span>
  <span class='comment val'>#here we have params[:location]==localhost for use_case_1_1.rb</span>
  <span class='comment val'>#cmd += &quot;#{params[:location]}:&quot; if ( params[:location] &amp;&amp; ( params[:location] != &quot;localhost&quot; ) )</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;#{file} &quot;</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;#{$ssh_user}@&quot;</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;#{destination}:&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='lparen token'>(</span> <span class='rubyid_destination identifier id'>destination</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span> <span class='neq op'>!=</span> <span class='string val'>&quot;localhost&quot;</span> <span class='rparen token'>)</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;#{path}&quot;</span>
  <span class='rubyid_command_result identifier id'>command_result</span> <span class='assign token'>=</span> <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_asynchronous_command identifier id'>asynchronous_command</span><span class='lparen token'>(</span><span class='rubyid_cmd identifier id'>cmd</span><span class='rparen token'>)</span>
  <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_command_wait identifier id'>command_wait</span><span class='lparen token'>(</span><span class='rubyid_command_result identifier id'>command_result</span><span class='lbrack token'>[</span><span class='string val'>&quot;command_number&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='rubyid_final_result identifier id'>final_result</span> <span class='assign token'>=</span> <span class='rubyid_make_task_result identifier id'>make_task_result</span><span class='lparen token'>(</span><span class='rubyid_command_result identifier id'>command_result</span><span class='lbrack token'>[</span><span class='string val'>&quot;command_number&quot;</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>

  <span class='rubyid_log_file_mgt identifier id'>log_file_mgt</span><span class='lparen token'>(</span><span class='rubyid_file identifier id'>file</span><span class='comma token'>,</span><span class='rubyid_final_result identifier id'>final_result</span><span class='comma token'>,</span><span class='string val'>&quot;PUT&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_return return kw'>return</span> <span class='rubyid_final_result identifier id'>final_result</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="simpletask-instance_method">
  
    - (<tt>Object</tt>) <strong>simpletask</strong>(location, task) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Fix me #######</p>

<pre class="code ruby18"><code>task with simple ssh. It is logged as a file operation</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


233
234
235
236
237
238
239
240
241
242
243
244</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/expolib.rb', line 233</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_simpletask identifier id'>simpletask</span><span class='lparen token'>(</span><span class='rubyid_location identifier id'>location</span><span class='comma token'>,</span><span class='rubyid_task identifier id'>task</span><span class='rparen token'>)</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='assign token'>=</span> <span class='string val'>&quot;ssh -o \&quot;ConnectTimeout 10\&quot;&quot;</span>
  <span class='comment val'>#cmd += &quot; lig_expe@#{location}&quot;</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; #{location}&quot;</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; #{task} &quot;</span>
  <span class='rubyid_command_result identifier id'>command_result</span> <span class='assign token'>=</span> <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_asynchronous_command identifier id'>asynchronous_command</span><span class='lparen token'>(</span><span class='rubyid_cmd identifier id'>cmd</span><span class='rparen token'>)</span>
  <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_command_wait identifier id'>command_wait</span><span class='lparen token'>(</span><span class='rubyid_command_result identifier id'>command_result</span><span class='lbrack token'>[</span><span class='string val'>&quot;command_number&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='rubyid_final_result identifier id'>final_result</span> <span class='assign token'>=</span> <span class='rubyid_make_task_result identifier id'>make_task_result</span><span class='lparen token'>(</span><span class='rubyid_command_result identifier id'>command_result</span><span class='lbrack token'>[</span><span class='string val'>&quot;command_number&quot;</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>

  <span class='rubyid_log_file_mgt identifier id'>log_file_mgt</span><span class='lparen token'>(</span><span class='rubyid_file identifier id'>file</span><span class='comma token'>,</span><span class='rubyid_final_result identifier id'>final_result</span><span class='comma token'>,</span><span class='string val'>&quot;Simple Task&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_return return kw'>return</span> <span class='rubyid_final_result identifier id'>final_result</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="task-instance_method">
  
    - (<tt>Object</tt>) <strong>task</strong>(location, task) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Starting Definitions of functions that belongs to the DSL of expo</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/expolib.rb', line 119</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_task identifier id'>task</span><span class='lparen token'>(</span><span class='rubyid_location identifier id'>location</span><span class='comma token'>,</span> <span class='rubyid_task identifier id'>task</span><span class='rparen token'>)</span>

  <span class='rubyid_path identifier id'>path</span><span class='comma token'>,</span><span class='rubyid_exec identifier id'>exec</span><span class='comma token'>,</span><span class='rubyid_params identifier id'>params</span> <span class='assign token'>=</span> <span class='rubyid_treat_task identifier id'>treat_task</span> <span class='rubyid_task identifier id'>task</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='assign token'>=</span> <span class='string val'>&quot;ruby taktuk2yaml.rb -s&quot;</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='rubyid_$ssh_connector gvar id'>$ssh_connector</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; -l #{$ssh_user}&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='notop op'>!</span><span class='rubyid_$ssh_user gvar id'>$ssh_user</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; -t #{$ssh_timeout}&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='notop op'>!</span><span class='rubyid_$ssh_timeout gvar id'>$ssh_timeout</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; -m #{location}&quot;</span>
  <span class='rubyid_cmd identifier id'>cmd</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; b e [ 'cd #{path} ; #{exec} #{params}' ]&quot;</span>

  <span class='rubyid_command_result identifier id'>command_result</span> <span class='assign token'>=</span> <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_asynchronous_command identifier id'>asynchronous_command</span><span class='lparen token'>(</span><span class='rubyid_cmd identifier id'>cmd</span><span class='rparen token'>)</span>
  <span class='rubyid_$client gvar id'>$client</span><span class='dot token'>.</span><span class='rubyid_command_wait identifier id'>command_wait</span><span class='lparen token'>(</span><span class='rubyid_command_result identifier id'>command_result</span><span class='lbrack token'>[</span><span class='string val'>&quot;command_number&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='rubyid_final_result identifier id'>final_result</span> <span class='assign token'>=</span> <span class='rubyid_make_taktuk_result identifier id'>make_taktuk_result</span><span class='lparen token'>(</span> <span class='rubyid_command_result identifier id'>command_result</span><span class='lbrack token'>[</span><span class='string val'>&quot;command_number&quot;</span><span class='rbrack token'>]</span> <span class='rparen token'>)</span>

  <span class='rubyid_log_task identifier id'>log_task</span><span class='lparen token'>(</span><span class='rubyid_exec identifier id'>exec</span><span class='comma token'>,</span><span class='rubyid_final_result identifier id'>final_result</span><span class='comma token'>,</span><span class='string val'>&quot;Sequential&quot;</span><span class='rparen token'>)</span>
  <span class='comment val'># $client.data_logger.info cmd</span>
  <span class='rubyid_return return kw'>return</span> <span class='rubyid_final_result identifier id'>final_result</span>

<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="treat_task-instance_method">
  
    - (<tt>Object</tt>) <strong>treat_task</strong>(task) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Treat the task which is a Sring in order to sperate it into path, exec,
cmdline params.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/expolib.rb', line 99</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_treat_task identifier id'>treat_task</span> <span class='rubyid_task identifier id'>task</span>
  <span class='comment val'>### here we split task into three things: PATH and executable and cmdline parameters.</span>
  <span class='comment val'>### This is done to avoid path errors.</span>
  <span class='comment val'># Separating path/executable and cmdline parameters</span>
  <span class='comment val'># Dont leave any space at the begining</span>
  <span class='rubyid_temp identifier id'>temp</span><span class='assign token'>=</span><span class='rubyid_task identifier id'>task</span><span class='dot token'>.</span><span class='rubyid_shellsplit identifier id'>shellsplit</span>
  <span class='rubyid_exec_with_path identifier id'>exec_with_path</span><span class='assign token'>=</span><span class='rubyid_temp identifier id'>temp</span><span class='dot token'>.</span><span class='rubyid_shift identifier id'>shift</span>
  <span class='rubyid_params identifier id'>params</span><span class='assign token'>=</span><span class='rubyid_temp identifier id'>temp</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot; &quot;</span><span class='rparen token'>)</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_temp identifier id'>temp</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span> 
  
  <span class='rubyid_path identifier id'>path</span><span class='assign token'>=</span><span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='rubyid_exec_with_path identifier id'>exec_with_path</span><span class='rparen token'>)</span>
  <span class='rubyid_exec identifier id'>exec</span><span class='assign token'>=</span><span class='rubyid_File constant id'>File</span><span class='dot token'>.</span><span class='rubyid_basename identifier id'>basename</span><span class='lparen token'>(</span><span class='rubyid_exec_with_path identifier id'>exec_with_path</span><span class='rparen token'>)</span>
  <span class='comment val'>## if task does not have path it is because is a command in the path</span>
  <span class='rubyid_exec identifier id'>exec</span> <span class='assign token'>=</span><span class='dstring node'>&quot;./#{exec}&quot;</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='lparen token'>(</span> <span class='rubyid_path identifier id'>path</span><span class='eq op'>==</span><span class='string val'>&quot;.&quot;</span><span class='rparen token'>)</span>
  <span class='comment val'>##### would be this option optional ? ####################</span>

  <span class='rubyid_return return kw'>return</span> <span class='lbrack token'>[</span><span class='rubyid_path identifier id'>path</span><span class='comma token'>,</span> <span class='rubyid_exec identifier id'>exec</span><span class='comma token'>,</span> <span class='rubyid_params identifier id'>params</span><span class='rbrack token'>]</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Mon Nov 19 13:00:40 2012 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.2.1 (ruby-1.8.7).
</div>

  </body>
</html>